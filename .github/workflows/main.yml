name: Keep Backend Alive (Ping Every Minute)

on:
  workflow_dispatch:
  schedule:
    - cron: '*/5 * * * *'  # fallback every 5 minutes if chaining breaks

jobs:
  ping:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      workflows: write

    steps:
      - name: Ping backend URL
        run: |
          echo "Pinging https://api.theholidaycreators.com/ ..."
          curl -fsS https://api.theholidaycreators.com/ > /dev/null || echo "Ping failed"

      - name: Wait and trigger next run
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          # wait 60 seconds, then dispatch this workflow again on the same branch
          sleep 60
          curl -s -X POST \
            -H "Authorization: token $GH_TOKEN" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/${{ github.repository }}/actions/workflows/${{ github.workflow }}/dispatches \
            -d '{"ref":"main"}' || echo "Dispatch failed"
